# Permit2
---

## 一、传统转账流程
``USER→TOKEN.approve(上链/付gas) + FUNC→TOKEN.transferFrom(上链/付gas)``
1. 授权数量 = 转账数量，优点是对用户的TOKEN比较安全，缺点是再次使用FUNC合约转账仍然要以上两步操作，多付gas。
2. 授权最大数（多数情况是uint256），优点是再次使用FUNC合约只需要第二步转账操作，可以节省再次授权gas，缺点是用户TOKEN有被FUNC合约静默转走的安全隐患。如遇到比较谨慎的用户可能会主动取消授权额度，这样就会实际产生三次上链操作，反而更消耗gas。

## 二、Permit2的角色和使用前提
1. Permit2的角色是用户代理人，代理用户的TOKEN授权和转账操作。
2. 必须先由用户授权TOKEN给Permit2合约一个额度（应该是一个大数uint160）。
3. 这个合约是一个公用合约，应该由pancake这样的权威方发布比较有公信力。

## 三、Permit2的两种使用方案
1. 有额度方案（类似传统）  
Permit2内置额度管理，仍然是先申请额度+转账的路径。
2. 无额度方案
不使用内置额度概念，直接转账。

## 四、Permit2有额度方案
1. 类传统用法，唯一区别是TOKEN合约换成PERMIT2合约。  
``USER→PERMIT2.approve(上链/付gas) + FUNC→PERMIT2.transferFrom(上链/付gas)``
2. 预签名用法。  
``USER→本地签名(不上链) + FUNC→(PERMIT2.permit + PERMIT2.transferFrom)(上链/付gas)``

## 五、Permit2无额度方案（主推方案）
没有额度概念，只有一种预签名用法。  
``USER→本地签名(不上链) + FUNC→(PERMIT2.permitTransferFrom)(上链/付gas)``

## 六、无额度预签名用法的优势
1. 每次交易只有一次上链操作，永远无需授权。
2. 需要用户确认两次插件弹出，第一次本地签名，第二次携带签名结果上链转账。
3. Permit2验证此签名的签署者和上链指定的付款人相同即认为是付款人本人的合法操作。也就是说通过Permit2的转账操作必须由付款人发起，不存在功能合约静默转账的可能。相当于转账时可以确权，无需前置的独立授权操作。
4. 用户在一个区块链网络上只需要唯一一次授权某TOKEN给Permit2合约（最大数uint160），以后即可在该链上所有支持此Permit2合约的功能合约针对该TOKEN进行简单安全的转账，可以省掉对不同功能合约的至少一次授权gas。
5. 支持多笔转账合并预签名一次，尤其在涉及多个功能合约时更显优势，具体用法可以参考**Universal Router**。
